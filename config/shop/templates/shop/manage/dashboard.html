{%extends 'shop/base.html'%}
{%block title%}Dashboard{%endblock%}

{%block content%}
<section class="panel">
    <h2>Store dashboard</h2>
    <!-- <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:12px; margin-top:12px;">
        <div class="panel"><div class="muted">Total orders</div><div style="font-size:24px;">{{total_orders}}</div></div>
        <div class="panel"><div class="muted">Paid orders</div><div style="font-size:24px;">{{paid_orders}}</div></div>
        <div class="panel"><div class="muted">Orders (7d)</div><div style="font-size:24px;">{{week_orders}}</div></div>
        <div class="panel"><div class="muted">Revenue</div><div style="font-size:24px;">{{revenue}}$</div></div>
    </div> -->
    <div style="display:flex; gap:10px; margin-top:14px;">
        <a class="btn btn--primary" href="{%url 'shop:manage_products'%}">Products</a>
        <a class="btn" href="{% url 'shop:manage_orders'%}">Orders</a>
    </div>
    <h3 style="margin-top:18px;">Recent orders</h3>
    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
        <tr>
            <th align="left">#</th>
            <th align="left">Customer</th>
            <th align="left">Total</th>
            <th align="left">Status</th>
            <th align="left"></th>
        </tr>
        {%for o in recent_orders%}
        <tr>
            <td>{{o.id}}</td>
            <td>{{o.first_name}} {{o.last_name}}</td>
            <td>{{o.total}}</td>
            <td>{{o.status}}</td>
            <td><a class="btn" href="{%url 'shop:manage_order_detail' o.id%}">Open</a></td>
        </tr>
        {%empty%}
        <tr><td colspan="5" class="muted">No orders yet</td></tr>
        {%endfor%}
    </table>
    <h2>Dashboard</h2>

    <canvas id="ordersChart" height="120"></canvas>
    <canvas id="revenueChart" height="120" style="margin-top:30px;"></canvas>
    <canvas id="statusChart" height="120" style="margin-top:30px;"></canvas>

</section>

<!-- {{orders_json|json_script:"orders-data"}}
{{revenue_json|json_script:"revenue-data"}}
{{status_json|json_script:"status-data"}} -->
{{orders_json|json_script:"orders-data"}}
{{revenue_json|json_script:"revenue-data"}}
{{status_json|json_script:"status-data"}}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const orders = JSON.parse(document.getElementById('orders-data').textContent);
    const revenue= JSON.parse(document.getElementById('revenue-data').textContent);
    const statusData= JSON.parse(document.getElementById('status-data').textContent);
    
    new Chart(document.getElementById('ordersChart'),{
        type: 'line',
        data: {
            labels: orders.map(o=>o.day),
            datasets:[{
                label:'Orders',
                data:orders.map(o=>o.count),
                borderWidth:2
            }]
        }
    });

    new Chart(document.getElementById('revenueChart'),{
        type: 'bar',
        data: {
            labels: revenue.map(r=>r.day),
            datasets:[{
                label:'Revenue',
                data:revenue.map(r=>r.total),
            }]
        }
    });

    new Chart(document.getElementById('statusChart'),{
        type: 'pie',
        data: {
            labels: statusData.map(s=>s.status),
            datasets:[{
                data:statusData.map(s=>s.count),
            }]
        }
    });
</script>
{%endblock%}